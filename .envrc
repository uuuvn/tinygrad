pkgs=(z3.lib llvmPackages.llvm)
pkgs+=(cargo rustc rust-analyzer rustfmt clippy)

linux && pkgs+=(stdenv.cc.cc.lib rdma-core liburing vulkan-loader ocl-icd)
linux && pkgs+=(vulkan-tools shaderc spirv-tools clinfo)
linux && pkgs+=(llvmPackages.clang llvmPackages.clang-tools llvmPackages.bintools llvmPackages.lldb)

tiny || pkgs+=(
  python312
  python312Packages.ruff
  python312Packages.mypy
  python312Packages.python-lsp-server
  python312Packages.pylsp-mypy
  python312Packages.python-lsp-ruff
)

use nix -p "${pkgs[@]}"

layout python

path_add PYTHONPATH "$PWD"

export CC=clang
darwin && export LLDB_DEBUGSERVER_PATH="/Applications/Xcode.app/Contents/SharedFrameworks/LLDB.framework/Versions/A/Resources/debugserver"
linux && export VK_ADD_LAYER_PATH="$(nix build --no-link --print-out-paths nixpkgs\#vulkan-validation-layers)/share/vulkan/explicit_layer.d"
